install.packages(c("dplyr", "readxl", "tidyverse"))
install.packages(c("dplyr", "readxl", "tidyverse"))
install.packages("estatapi")
source('~/Downloads/chizai_historical_after_1975_by_eStat.R', echo=TRUE)
library(tidyverse)
install.packages(`tidyverse`)
install.packages('tidyverse')
source('~/Downloads/chizai_historical_after_1975_by_eStat.R', echo=TRUE)
library(tidyverse)
install.packages('tidyverse')
library(estatapi)
library(tidyverse)
install.packages('tidyverse')
install.packages("tidyverse")
library(tidyverse)
library(tidyverse)
install.packages(c("clipr", "cluster", "MASS", "Matrix", "mgcv", "nlme", "rpart", "survival", "tinytex"))
library(tidyverse)
library("tidyverse")
install.packages("tidyverse")
library(estatapi)
library(tidyverse)
AppID <- "34c4af7da8d5e0a88338a51ab42c4b6ca30e8bd2"
# 事前調査１：統計の検索
ResultData <- estat_getStatsList(appId = AppID, searchWord = "社会・人口統計体系")
ResultData %>% as.data.frame() %>% head() # 頭6行を見る
# これが財政の統計
# 0000010104
# 社会・人口統計体系
# 総務省
# 都道府県データ 基礎データ
# Ｄ　行政基盤
# https://www.e-stat.go.jp/stat-search/database?page=1&layout=datalist&toukei=00200502&tstat=000001111375&cycle=8&tclass1=000001111377&statdisp_id=0000010104&result_page=1&second=1&second2=1
# 事前調査２：統計のIDを指定してメタ情報を取得
StatID = "0000010104"
MetaInfo <- estat_getMetaInfo(appId = AppID, statsDataId = StatID)
MetaInfo
# MetaInfo$cat01 %>% View
MetaInfo$cat01$`@name` %>% str_subset("都道府県")
# ほしい変数のカテゴリ名
category = MetaInfo$cat01$`@name` %>% str_subset("都道府県") %>%
str_subset("議会費|総務費|民生費|生活保護費|労働費|農林水産業費|商工費|土木費|災害復旧事業費|公債費（都道府県財政）（目的別歳出内訳）|歳出決算総額|衛生費|児童福祉費|小学校費|教育費|中学校費|幼稚園費")
# 本番：統計のIDを指定してデータを取得
StatData <- estat_getStatsData(appId = AppID,
statsDataId = StatID,
# cdCat01 = category[3] %>% str_extract("[:alnum:]+"),
cdCat01 = category %>% str_extract("[:alnum:]+"),
cdTime = 1975:1979 %>% str_c("100000"))
# 議会費, 総務費は2010年以降しか無い模様
# 中身をチェック
StatData %>% str()
StatData %>% as.data.frame() %>% head()
StatData$`Ｄ　行政基盤` %>% unique()%>%
str_subset("議会費|総務費|民生費|生活保護費|労働費|農林水産業費|商工費|土木費|災害復旧事業費|公債費（都道府県財政）（目的別歳出内訳）|歳出決算総額|衛生費|児童福祉費|小学校費|教育費|中学校費|幼稚園費")
# 整形
df = StatData %>% as_data_frame() %>% select(year = 調査年, fuken = 地域, variable = `Ｄ　行政基盤`, value) %>%
mutate(year = year %>% str_extract("[0-9]+"),
variable = variable %>% str_remove_all("D|[0-9]|_|（.+）")) %>%
spread(variable, value) %>%
rename(kosai = 公債費, saigai = 災害復旧事業費, shoko = 商工費, doboku = 土木費, norin = 農林水産業費,
minsei = 民生費, rodo = 労働費, jifuku = 児童福祉費, kyoiku = 教育費, eisei = 衛生費,
shogaku = 小学校費, chugaku = 中学校費, yochien = 幼稚園費, total = 歳出決算総額,
seiho = 生活保護費) %>%
select(-社会教育費) #「教育」にヒットして紛れ込んでいたので削除
df = df %>% mutate(fuken = fuken %>% str_replace_all("全国","ken_all"))
install.packages('tidyverse')
library(estatapi)
library(tidyverse)
