Grunfeld %>% ggplot(aes(x = capital, y = inv, colour = as.factor(firm))) + geom_point()
# 企業価値(X1)と 資本ストック(X2)
Grunfeld %>% ggplot(aes(x = value, y = capital, colour = as.factor(firm))) + geom_point()
# Chunk 9
# lm
pooled_lm <- lm(inv ~ value + capital, data = Grunfeld)
# lm_robust
pooled_robust <-  lm_robust(inv ~ value + capital, data = Grunfeld,
se_type = "HC1") # HC1はロバスト標準誤差の種類
#結果表の出力
screenreg(list(pooled_lm, pooled_robust),
custom.model.names = c("Pooled", "Pooled, robust"),
include.ci = FALSE, digits = 3)
# Chunk 10
#n-1個の個体ダミーを直接導入
oneway_fe1 <- lm_robust(inv ~ value + capital + factor(firm) ,
data = Grunfeld,
clusters = firm, #クラスタのレベルを指定
se_type = "stata") #クラスタSE: Stataと同一のものを使う
#lm_robustの"fixed_effects"オプションを利用
oneway_fe2 <- lm_robust(inv ~ value + capital, data = Grunfeld,
fixed_effects = ~ firm, #個体固定効果の指定
clusters = firm, #クラスタのレベルを指定
se_type = "stata")  #クラスタSE: Stataと同一のものを使う
#結果表の出力
screenreg(list(pooled_robust, oneway_fe1, oneway_fe2),
custom.model.names = c("Pooled", "Oneway 1", "Oneway 2"),
include.ci = FALSE, digits = 3)
# Chunk 11
#n-1個の個体ダミーとT-1個の年ダミーを直接導入
twoway_fe1 <- lm_robust(inv ~ value + capital + factor(firm) + factor(year) ,
data = Grunfeld,
clusters = firm, #クラスタのレベルを指定
se_type = "stata") #クラスタSE: Stataと同一のものを使う
#lm_robustの"fixed_effects"オプションを利用
twoway_fe2 <- lm_robust(inv ~ value + capital, data = Grunfeld,
fixed_effects = ~ firm + year, #個体固定効果、時間固定効果の指定
clusters = firm, #クラスタのレベルを指定
se_type = "stata") #クラスタSE: Stataと同一のものを使う
#結果表の出力
screenreg(list(pooled_robust, oneway_fe1, oneway_fe2, twoway_fe1, twoway_fe2),
custom.model.names = c("Pooled", "Oneway 1", "Oneway 2", "Twoway 1", "Twoway 2"),
include.ci = FALSE, digits = 3)
# Chunk 12
original_df <- Grunfeld # いったんdfとして読み込む（下記のpdata.frameの説明のための便宜的な処置）
panel_df <- pdata.frame(original_df, index = c("firm", "year")) # 個体=firm、時間=yearと認識させたdf
# Chunk 13
# lmによるpooled OLS
pool_lm <- lm(inv ~ value + capital, data = panel_df)
# plmによるpooled OLS
pool_plm <- plm(inv ~ value + capital, data = panel_df,
model = "pooling")
#stargazer
stargazer(pool_lm, pool_plm, type = "text",
digits = 3, df = FALSE,
column.labels = c("Pooled lm", "Pooled plm"),
model.names = F, model.numbers = F)
# Chunk 14
# lmによる固定効果モデル推定(個体固定効果のみ）
# panel_dfにおけるfirmはすでに因子に変換されているので、
# そのままでも個体ダミー変数となるが、誤解のないようにfactor(firm)と書く。
fe_oneway_lm <- lm(inv ~ value + capital + factor(firm), data = panel_df)
# plmによる固定効果モデル推定（個体固定効果のみ）
# yearも因子なので、factor(year)と書くと、ダミー変数として認識される。
fe_oneway_plm <- plm(inv ~ value + capital,
data = panel_df, model = "within") # within=固定効果モデル
#stargazer
stargazer(pool_lm, pool_plm, fe_oneway_lm, fe_oneway_plm,
type = "text", digits = 3, df = FALSE,
column.labels = c("Pooled lm", "Pooled plm", "Oneway lm", "Oneway plm"),
model.names = F, model.numbers = F)
# lm関数による固定効果モデル推定(個体固定効果と時間固定効果)
# panel_dfにおけるfirmとyearはすでに因子に変換されているので、
# そのままでも個体ダミー変数となるが、誤解のないようにfactor(firm), factor(year)と書く。
fe_twoway_lm <- lm(inv ~ value + capital + factor(firm) + factor(year), data = panel_df)
# plmの固定効果モデル推定（個体固定効果と時間固定効果）
fe_twoway_plm <- plm(inv ~ value + capital,
data = panel_df, model = "within",
effect = "twoways") # within=固定効果モデル
#stargazer
stargazer(pool_lm, pool_plm, fe_oneway_lm, fe_oneway_plm, fe_twoway_lm, fe_twoway_plm,
type = "text", digits = 3, df = FALSE,
column.labels = c("Pooled lm", "Pooled plm", "Oneway lm", "Oneway plm", "Twoway lm", "Twoway plm"),
model.names = F, model.numbers = F)
# Chunk 1
knitr::opts_chunk$set(fig.align = 'center', message = F, warning = F)
# Chunk 3
pacman::p_load(tidyverse,
stargazer,
Hmisc,
estimatr,
texreg,
plm)
# Chunk 4
library(tidyverse)
library(plm)
data(Grunfeld)
Grunfeld %>% rename(`企業ID`=firm, `年度`=year, `投資額`=inv, `企業価値`=value, `資本ストック`=capital) %>%
filter(1951 <= `年度` & `年度` <= 1953) %>% head() %>% knitr::kable()
# Chunk 6
# 事前準備 ------------
# パッケージの読み込み
library(tidyverse)
library(estimatr) # lm_robustによるパネルデータ分析
library(plm) # plmによるパネルデータ分析
library(stargazer) # lmやplmのときの結果表
library(texreg) # lmやplmやlm_robustのときの結果表
library(lmtest) # lmやplmでロバスト標準誤差に修正
# Chunk 7
# データ読み込み
data("Grunfeld")
head(Grunfeld)
# Chunk 8
# 投資総額(Y)
Grunfeld %>% ggplot(aes(x = year, y = inv, colour = as.factor(firm))) + geom_line()
# 企業価値(X1)
Grunfeld %>% ggplot(aes(x = year, y = value, colour = as.factor(firm))) + geom_line()
# 資本ストック(X2)
Grunfeld %>% ggplot(aes(x = year, y = capital, colour = as.factor(firm))) + geom_line()
# 企業価値(X1)と投資総額(Y)
Grunfeld %>% ggplot(aes(x = value, y = inv, colour = as.factor(firm))) + geom_point()
# 資本ストック(X2)と投資総額(Y)
Grunfeld %>% ggplot(aes(x = capital, y = inv, colour = as.factor(firm))) + geom_point()
# 企業価値(X1)と 資本ストック(X2)
Grunfeld %>% ggplot(aes(x = value, y = capital, colour = as.factor(firm))) + geom_point()
# Chunk 9
# lm
pooled_lm <- lm(inv ~ value + capital, data = Grunfeld)
# lm_robust
pooled_robust <-  lm_robust(inv ~ value + capital, data = Grunfeld,
se_type = "HC1") # HC1はロバスト標準誤差の種類
#結果表の出力
screenreg(list(pooled_lm, pooled_robust),
custom.model.names = c("Pooled", "Pooled, robust"),
include.ci = FALSE, digits = 3)
# Chunk 10
#n-1個の個体ダミーを直接導入
oneway_fe1 <- lm_robust(inv ~ value + capital + factor(firm) ,
data = Grunfeld,
clusters = firm, #クラスタのレベルを指定
se_type = "stata") #クラスタSE: Stataと同一のものを使う
#lm_robustの"fixed_effects"オプションを利用
oneway_fe2 <- lm_robust(inv ~ value + capital, data = Grunfeld,
fixed_effects = ~ firm, #個体固定効果の指定
clusters = firm, #クラスタのレベルを指定
se_type = "stata")  #クラスタSE: Stataと同一のものを使う
#結果表の出力
screenreg(list(pooled_robust, oneway_fe1, oneway_fe2),
custom.model.names = c("Pooled", "Oneway 1", "Oneway 2"),
include.ci = FALSE, digits = 3)
# Chunk 11
#n-1個の個体ダミーとT-1個の年ダミーを直接導入
twoway_fe1 <- lm_robust(inv ~ value + capital + factor(firm) + factor(year) ,
data = Grunfeld,
clusters = firm, #クラスタのレベルを指定
se_type = "stata") #クラスタSE: Stataと同一のものを使う
#lm_robustの"fixed_effects"オプションを利用
twoway_fe2 <- lm_robust(inv ~ value + capital, data = Grunfeld,
fixed_effects = ~ firm + year, #個体固定効果、時間固定効果の指定
clusters = firm, #クラスタのレベルを指定
se_type = "stata") #クラスタSE: Stataと同一のものを使う
#結果表の出力
screenreg(list(pooled_robust, oneway_fe1, oneway_fe2, twoway_fe1, twoway_fe2),
custom.model.names = c("Pooled", "Oneway 1", "Oneway 2", "Twoway 1", "Twoway 2"),
include.ci = FALSE, digits = 3)
# Chunk 12
original_df <- Grunfeld # いったんdfとして読み込む（下記のpdata.frameの説明のための便宜的な処置）
panel_df <- pdata.frame(original_df, index = c("firm", "year")) # 個体=firm、時間=yearと認識させたdf
# Chunk 13
# lmによるpooled OLS
pool_lm <- lm(inv ~ value + capital, data = panel_df)
# plmによるpooled OLS
pool_plm <- plm(inv ~ value + capital, data = panel_df,
model = "pooling")
#stargazer
stargazer(pool_lm, pool_plm, type = "text",
digits = 3, df = FALSE,
column.labels = c("Pooled lm", "Pooled plm"),
model.names = F, model.numbers = F)
# Chunk 14
# lmによる固定効果モデル推定(個体固定効果のみ）
# panel_dfにおけるfirmはすでに因子に変換されているので、
# そのままでも個体ダミー変数となるが、誤解のないようにfactor(firm)と書く。
fe_oneway_lm <- lm(inv ~ value + capital + factor(firm), data = panel_df)
# plmによる固定効果モデル推定（個体固定効果のみ）
# yearも因子なので、factor(year)と書くと、ダミー変数として認識される。
fe_oneway_plm <- plm(inv ~ value + capital,
data = panel_df, model = "within") # within=固定効果モデル
#stargazer
stargazer(pool_lm, pool_plm, fe_oneway_lm, fe_oneway_plm,
type = "text", digits = 3, df = FALSE,
column.labels = c("Pooled lm", "Pooled plm", "Oneway lm", "Oneway plm"),
model.names = F, model.numbers = F)
# lm関数による固定効果モデル推定(個体固定効果と時間固定効果)
# panel_dfにおけるfirmとyearはすでに因子に変換されているので、
# そのままでも個体ダミー変数となるが、誤解のないようにfactor(firm), factor(year)と書く。
fe_twoway_lm <- lm(inv ~ value + capital + factor(firm) + factor(year), data = panel_df)
# plmの固定効果モデル推定（個体固定効果と時間固定効果）
fe_twoway_plm <- plm(inv ~ value + capital,
data = panel_df, model = "within",
effect = "twoways") # within=固定効果モデル
#stargazer
stargazer(pool_lm,
pool_plm,
fe_oneway_lm,
fe_oneway_plm,
fe_twoway_lm,
fe_twoway_plm,
type = "text", digits = 3, df = FALSE,
column.labels = c("Pooled lm",
"Pooled plm",
"Oneway lm",
"Oneway plm",
"Twoway lm",
"Twoway plm"),
model.names = F, model.numbers = F)
# lm関数による固定効果モデル推定(個体固定効果と時間固定効果)
# panel_dfにおけるfirmとyearはすでに因子に変換されているので、
# そのままでも個体ダミー変数となるが、誤解のないようにfactor(firm), factor(year)と書く。
fe_twoway_lm <- lm(inv ~ value + capital + factor(firm) + factor(year), data = panel_df)
# plmの固定効果モデル推定（個体固定効果と時間固定効果）
fe_twoway_plm <- plm(inv ~ value + capital,
data = panel_df, model = "within",
effect = "twoways") # within=固定効果モデル
#stargazer
stargazer(pool_lm,
pool_plm,
fe_oneway_lm,
fe_oneway_plm,
fe_twoway_lm,
fe_twoway_plm,
type = "text", digits = 3, df = FALSE,
column.labels = c("Pooled lm",
"Pooled plm",
"Oneway lm",
"Oneway plm",
"Twoway lm",
"Twoway plm"),
model.names = F, model.numbers = F)
# plmの固定効果モデル推定2（個体固定効果と時間固定効果）
fe_twoway_plm2 <- plm(inv ~ value + capital + factor(year),
data = panel_df, model = "within") # within =固定効果モデル
#stargazerで3つのtwoway FEを比べる。
stargazer(fe_twoway_lm, fe_twoway_plm, fe_twoway_plm2, type = "text",
digits = 3, df = FALSE,
column.labels = c("Twoway lm", "Twoway plm", "Twoway plm2"),
model.names = F, model.numbers = F)
# lm関数による固定効果モデル推定(個体固定効果と時間固定効果)
# panel_dfにおけるfirmとyearはすでに因子に変換されているので、
# そのままでも個体ダミー変数となるが、誤解のないようにfactor(firm), factor(year)と書く。
fe_twoway_lm <- lm(inv ~ value + capital + factor(firm) + factor(year), data = panel_df)
# plmの固定効果モデル推定（個体固定効果と時間固定効果）
fe_twoway_plm <- plm(inv ~ value + capital,
data = panel_df, model = "within",
effect = "twoways") # within=固定効果モデル
#stargazer
stargazer(pool_lm,
pool_plm,
fe_oneway_lm,
fe_oneway_plm,
fe_twoway_lm,
fe_twoway_plm,
type = "text", digits = 3, df = FALSE,
column.labels = c("Pooled lm",
"Pooled plm",
"Oneway lm",
"Oneway plm",
"Twoway lm",
"Twoway plm"),
model.names = F, model.numbers = F)
# plmの固定効果モデル推定2（個体固定効果と時間固定効果）
fe_twoway_plm2 <- plm(inv ~ value + capital + factor(year),
data = panel_df, model = "within") # within =固定効果モデル
#stargazerで3つのtwoway FEを比べる。
stargazer(fe_twoway_lm, fe_twoway_plm, fe_twoway_plm2,
type = "text",
digits = 3, df = FALSE,
column.labels = c("Twoway lm", "Twoway plm", "Twoway plm2"),
model.names = F, model.numbers = F)
#stargazer
stargazer(pool_lm,
pool_plm,
fe_oneway_lm,
fe_oneway_plm,
fe_twoway_lm,
fe_twoway_plm,
type = "text",
digits = 3,
df = FALSE,
column.labels = c("Pooled lm",
"Pooled plm",
"Oneway lm",
"Oneway plm",
"Twoway lm",
"Twoway plm"),
model.names = F, model.numbers = F)
# plmの固定効果モデル推定（個体固定効果と時間固定効果）
fe_twoway_plm <- plm(inv ~ value + capital,
data = panel_df, model = "within",
effect = "twoways") # within=固定効果モデル
# stargazerで比べる。
stargazer(fe_twoway_lm, fe_twoway_lm_robust, fe_twoway_plm, fe_twoway_plm_clustered,
type = "text",
digits = 3,
df = FALSE,
column.labels = c("lm", "lm,robust", "plm", "plm,clustered"),
model.names = F,
model.numbers = F)
# lmで推定したものをロバスト標準誤差にする。
fe_twoway_lm_robust <- coeftest(fe_twoway_lm,
vcovHC(fe_twoway_lm, method = "arellano", type = "HC1"))
#plmで推定したものをクラスタロバスト標準誤差にする。
fe_twoway_plm_clustered <- coeftest(fe_twoway_plm,
vcovHC(fe_twoway_plm, method = "arellano", type = "HC1"))
# stargazerで比べる。
stargazer(fe_twoway_lm, fe_twoway_lm_robust, fe_twoway_plm, fe_twoway_plm_clustered,
type = "text",
digits = 3,
df = FALSE,
column.labels = c("lm", "lm,robust", "plm", "plm,clustered"),
model.names = F,
model.numbers = F)
# lmで推定したものをロバスト標準誤差にする。
fe_twoway_lm_robust <- coeftest(fe_twoway_lm,
vcovHC(fe_twoway_lm, method = "arellano", type = "HC1"))
#plmで推定したものをクラスタロバスト標準誤差にする。
fe_twoway_plm_clustered <- coeftest(fe_twoway_plm,
vcovHC(fe_twoway_plm, method = "arellano", type = "HC1"))
# stargazerで比べる。
stargazer(fe_twoway_lm, fe_twoway_lm_robust, fe_twoway_plm, fe_twoway_plm_clustered,
type = "text",
digits = 3,
df = FALSE,
column.labels = c("lm", "lm,robust", "plm", "plm,clustered"),
model.names = F,
model.numbers = F)
#stargazer
stargazer(pool_lm,
pool_plm,
fe_oneway_lm,
fe_oneway_plm,
fe_twoway_lm,
fe_twoway_plm,
type = "text",
digits = 3,
df = FALSE,
column.labels = c("Pooled lm",
"Pooled plm",
"Oneway lm",
"Oneway plm",
"Twoway lm",
"Twoway plm"),
model.names = F, model.numbers = F)
fe_oneway_lm <- lm(inv ~ value + capital + factor(firm), data = panel_df)
# plmによる固定効果モデル推定（個体固定効果のみ）
# yearも因子なので、factor(year)と書くと、ダミー変数として認識される。
fe_oneway_plm <- plm(inv ~ value + capital,
data = panel_df, model = "within") # within=固定効果モデル
#stargazer
stargazer(pool_lm, pool_plm, fe_oneway_lm, fe_oneway_plm,
type = "text", digits = 3, df = FALSE,
column.labels = c("Pooled lm", "Pooled plm", "Oneway lm", "Oneway plm"),
model.names = F, model.numbers = F)
#                  "Twoway plm"),
#fe_twoway_plm,
# plmの固定効果モデル推定（個体固定効果と時間固定効果）
fe_twoway_plm <- plm(inv ~ value + capital,
data = panel_df, model = "within",
effect = "twoways") # within=固定効果モデル
#stargazer
stargazer(pool_lm,
pool_plm,
fe_oneway_lm,
fe_oneway_plm,
fe_twoway_lm,
#fe_twoway_plm,
type = "text",
digits = 3,
df = FALSE,
column.labels = c("Pooled lm",
"Pooled plm",
"Oneway lm",
"Oneway plm",
"Twoway lm")
#                  "Twoway plm"),
model.names = F, model.numbers = F)
#stargazer
stargazer(pool_lm,
pool_plm,
fe_oneway_lm,
fe_oneway_plm,
fe_twoway_lm,
#fe_twoway_plm,
type = "text",
digits = 3,
df = FALSE,
column.labels = c("Pooled lm",
"Pooled plm",
"Oneway lm",
"Oneway plm",
"Twoway lm"),
#                  "Twoway plm"),
model.names = F, model.numbers = F)
#stargazer
stargazer(pool_lm,
pool_plm,
fe_oneway_lm,
fe_oneway_plm,
fe_twoway_lm,
fe_twoway_plm,
type = "text",
digits = 3,
df = FALSE,
column.labels = c("Pooled lm",
"Pooled plm",
"Oneway lm",
"Oneway plm",
"Twoway lm"),
"Twoway plm"),
model.names = F, model.numbers = F)
#stargazer
stargazer(pool_lm,
pool_plm,
fe_oneway_lm,
fe_oneway_plm,
fe_twoway_lm,
fe_twoway_plm,
type = "text",
digits = 3,
df = FALSE,
column.labels = c("Pooled lm",
"Pooled plm",
"Oneway lm",
"Oneway plm",
"Twoway lm",
"Twoway plm"),
model.names = F, model.numbers = F)
#stargazer
stargazer(pool_lm,
pool_plm,
fe_oneway_lm,
fe_oneway_plm,
fe_twoway_lm,
fe_twoway_plm,
type = "text",
digits = 3,
df = FALSE,
column.labels = c("Pooled lm",
"Pooled plm",
"Oneway lm",
"Oneway plm",
"Twoway lm",
"Twoway plm"),
model.names = F, model.numbers = F)
# plmの固定効果モデル推定（個体固定効果と時間固定効果）
fe_twoway_plm <- plm(inv ~ value + capital,
data = panel_df, model = "within",
effect = "twoways") # within=固定効果モデル
#stargazer
stargazer(#pool_lm,
pool_plm,
fe_oneway_lm,
fe_oneway_plm,
fe_twoway_lm,
fe_twoway_plm,
type = "text",
digits = 3,
df = FALSE,
column.labels = c(#"Pooled lm",
"Pooled plm",
"Oneway lm",
"Oneway plm",
"Twoway lm",
"Twoway plm"),
model.names = F, model.numbers = F)
#結果表の出力
screenreg(list(pooled_lm, pooled_robust),
custom.model.names = c("Pooled", "Pooled, robust"),
include.ci = FALSE, digits = 3)
#stargazer
stargazer(fe_oneway_lm,
fe_oneway_plm,
fe_twoway_lm,
fe_twoway_plm,
type = "text",
digits = 3,
df = FALSE,
column.labels = c("Oneway lm",
"Oneway plm",
"Twoway lm",
"Twoway plm"),
model.names = F, model.numbers = F)
　　　　　　+ geom_line()
# 投資総額(Y)
Grunfeld %>% ggplot(aes(x = year,
y = inv,
colour = as.factor(firm))) +
　　　　　　geom_line()
pacman::p_load(readxl,
tidyverse,
AER,
estimatr,
skimr,
stargazer,
texreg)
data("CPS1985")
head(CPS1985)
#textでの表示
stargazer(CPS1985, type = "text")
#htmlで表示し、summary_CPS1985.htmlという名前での保存
stargazer(CPS1985, type = "html", out = "summary_CPS1985.html")
getwd()
